!function(a){function d(t){var i=null;return"string"==typeof t?i=t:"object"==typeof t&&t instanceof jQuery&&(i=a("textarea[id^=widget-black-studio-tinymce]",t.closest(bstw_data.container_selectors)).attr("id")),{activate:function(){if(a("#"+i).addClass("mceEditor"),"object"==typeof tinymce&&"function"==typeof tinymce.execCommand){this.deactivate(),tinyMCEPreInit.mceInit[i]=tinyMCEPreInit.mceInit["black-studio-tinymce-widget"],tinyMCEPreInit.mceInit[i].selector="#"+i;try{tinymce.init(tinymce.extend({},tinyMCEPreInit.mceInit["black-studio-tinymce-widget"],tinyMCEPreInit.mceInit[i])),tinymce.execCommand("mceAddControl",!1,i)}catch(t){window.alert(t)}this.is_tinymce_active()&&"function"==typeof tinymce.get(i).on&&tinymce.get(i).on("keyup change",function(){var t=tinymce.get(i).getContent();a("#"+i).val(t).change()})}return this},deactivate:function(){if("object"==typeof tinymce&&"function"==typeof tinymce.execCommand&&this.is_tinymce_active()){var t=tinymce.get(i).getContent();tinymce.get(i).remove(),a("#"+i).val(t)}return this},activate_after_open:function(){return"visual"===this.get_mode()&&(0===a("div.widget:has(#"+i+") :animated").size()&&!this.is_tinymce_active()&&this.is_textearea_visible()?this.set_mode("visual"):this.is_tinymce_active()?this.set_mode("visual"):setTimeout(function(){d(i).activate_after_open()},100)),this},activate_after_ajax:function(){return"visual"===this.get_mode()&&(0===a.active&&!this.is_tinymce_active()&&this.is_textearea_visible()?this.set_mode("visual"):this.is_widget_inside_visible()&&!this.is_tinymce_active()&&setTimeout(function(){d(i).activate_after_ajax()},100)),this},get_widget:function(){return a("#"+i).closest("div.widget")},get_widget_inside:function(){return a("#"+i).closest("div.widget-inside")},get_editor_wrap:function(){return a("#"+i).closest("div.wp-editor-wrap")},get_textarea:function(){return a("#"+i)},get_id:function(){return i},get_tinymce:function(){return tinymce.get(i)},get_mode:function(){return a("input[id^=widget-black-studio-tinymce][id$=type]",this.get_widget_inside()).val()},set_mode:function(t){return"visual"===t&&(this.get_editor_wrap().removeClass("html-active").addClass("tmce-active"),this.activate()),"html"===t&&(this.get_editor_wrap().removeClass("tmce-active").addClass("html-active"),this.deactivate()),a("input[id^=widget-black-studio-tinymce][id$=type]",this.get_widget_inside()).val(t),this},is_tinymce_active:function(){return"object"==typeof tinymce&&"object"==typeof tinymce.get(i)&&null!==tinymce.get(i)},is_textearea_visible:function(){return a("#"+i).is(":visible")},is_widget_inside_visible:function(){return a(" div.widget-inside:has(#"+i+")").is(":visible")},check_duplicates:function(){return 1<a('[name="'+this.get_textarea().attr("name")+'"]').size()&&0===a("div.error",this.get_widget_inside()).length&&this.get_widget_inside().prepend('<div class="error"><strong>'+bstw_data.error_duplicate_id+"</strong></div>"),this},fix_css:function(){return this.get_widget().css("position","relative").css("z-index","100000"),a("#wpbody-content").css("overflow","visible"),this},set_media_target:function(){return a(".insert-media",this.get_widget()).data("editor",i),this}}}a(document).ready(function(){a(document).on("click","div.widget[id*=black-studio-tinymce] .widget-title, div.widget[id*=black-studio-tinymce] a.widget-action",function(){if(d(a(this)).check_duplicates().fix_css().set_media_target().activate_after_open(),a("input[name=savewidget]",d(a(this)).get_widget()).on("click",function(){d(a(this)).is_tinymce_active()&&d(a(this)).deactivate(),a(this).unbind("ajaxSuccess").ajaxSuccess(function(){d(a(this)).activate_after_ajax()})}),!a(this).parents("#available-widgets").length){var t,i=parseInt(a("input[name=widget-width]",d(a(this)).get_widget()).val(),10),e=a(window).width(),n=d(a(this)).get_widget().parent().width(),c=parseInt(a("#wpcontent").css("margin-left"),10),s=!("undefined"==typeof isRtl||!isRtl);e<i+c+30&&(t=d(a(this)).get_widget().closest("div.widget-liquid-right").length?s?"margin-right":"margin-left":s?"margin-left":"margin-right",a(d(a(this)).get_widget()).css(t,n-(e-30-c)+"px"))}}),a("div.widget[id*=black-studio-tinymce] input[name=savewidget]").on("click",function(){d(a(this)).is_tinymce_active()&&d(a(this)).deactivate(),a(this).unbind("ajaxSuccess").ajaxSuccess(function(){d(a(this)).activate_after_ajax()})}),a(document).on("click","a[id^=widget-black-studio-tinymce][id$=tmce]",function(){d(a(this)).set_mode("visual")}),a(document).on("click","a[id^=widget-black-studio-tinymce][id$=html]",function(){d(a(this)).set_mode("html")}),a(document).on("widget-added",function(t,i){i.is("[id*=black-studio-tinymce]")&&(t.preventDefault(),d(i).activate_after_open())}),a(document).on("click",".wp-media-buttons a",function(){window.wpActiveEditor=d(a(this)).get_id()}),0<a("body.widgets_access").size()&&d(a("textarea[id^=widget-black-studio-tinymce]").attr("id")).activate_after_open(),a(document).on("click",".bstw-links-icon",function(t){t.preventDefault(),a(this).closest(".bstw-links").children(".bstw-links-list").toggle()})})}(jQuery);