function w3tc_seconds_to_string(t){var e,s,r,i="";return(e=Math.floor(t/86400))&&(t-=86400*e,i+=e+"d "),(s=Math.floor(t/3600))&&(t-=3600*s,i+=s+"h "),(r=Math.floor(t/60))&&(t-=60*r,i+=r+"m "),t&&(i+=t+"s"),i}var W3tc_Popup_Cdn_Export_File={paused:0,limit:25,retry_seconds:10,seconds_elapsed:0,timer:null,nonce:"",files:[],initialized:!1,upload_files:[],set_progress:function(t){jQuery("#cdn_export_file_progress .bar").width(t+"%"),jQuery("#cdn_export_file_progress .percent").html(t+"%")},set_status:function(t){jQuery("#cdn_export_file_status").html(t)},set_processed:function(t){jQuery("#cdn_export_file_processed").html(t)},set_button_text:function(t){jQuery("#cdn_export_file_start").val(t)},set_last_response:function(){var t=new Date;jQuery("#cdn_export_file_last_response").html(t.toLocaleTimeString()+" "+t.toLocaleDateString())},set_elapsed:function(t){jQuery("#cdn_export_file_elapsed").html(t)},add_log:function(t,e,s){jQuery("#cdn_export_file_log").prepend('<div class="log-'+(1==e?"success":"error")+'">'+t+" <strong>"+s+"</strong></div>")},clear_log:function(){jQuery("#cdn_export_file_log").html("")},process:function(){if(!this.paused){this.initialized||(this.upload_files=this.files.slice(0),this.initialized=!0),to_upload=this.upload_files.slice(0,this.limit);var e=this;to_upload.length&&jQuery.ajax({type:"POST",url:"admin.php?page=w3tc_cdn",data:{w3tc_cdn_export_process:1,"files[]":to_upload,_wpnonce:this.nonce},dataType:"json",success:function(t){e.set_last_response(),e.process_callback(t)},error:function(){e.set_last_response(),e.retry(e.retry_seconds)}})}},retry:function(t){if(!this.paused)if(this.set_status("request failed (retry in "+t+"s)"),t){var e=this;setTimeout(function(){e.retry(--t)},1e3)}else this.set_status("processing"),this.process()},process_callback:function(t){for(var e=!1,s=0;s<t.results.length;s++){for(var r=t.results[s].file,i=0;i<this.upload_files.length;i++)if(this.upload_files[i]==r){this.upload_files.splice(i,1);break}if(this.add_log(r,t.results[s].result,t.results[s].error),-1==t.results[s].result){e=!0;break}}if(e)this.set_progress(0),this.set_processed(1),this.set_status("failed"),this.set_button_text("Start"),clearInterval(this.timer);else{var n=this.files.length-this.upload_files.length;this.set_progress((100*n/this.files.length).toFixed(0)),this.set_processed(n),this.upload_files.length?this.process():(this.set_status("done"),this.set_button_text("Start"),clearInterval(this.timer))}},timer_callback:function(){this.seconds_elapsed++,this.set_elapsed(w3tc_seconds_to_string(this.seconds_elapsed))},init:function(){var t=this;jQuery("#cdn_export_file_start").click(function(){"Pause"==this.value?(t.paused=1,t.set_button_text("Resume"),t.set_status("paused"),clearInterval(t.timer)):("Start"==this.value&&(t.seconds_elapsed=0,t.initialized=!1,t.clear_log(),t.set_progress(0),t.set_processed(0),t.set_elapsed("-")),t.paused=0,t.set_button_text("Pause"),t.set_status("processing"),t.timer=setInterval(function(){t.timer_callback()},1e3)),t.process()})}},W3tc_Popup_Cdn_Export_Library={paused:0,limit:25,offset:0,retry_seconds:10,seconds_elapsed:0,timer:null,nonce:"",set_progress:function(t){jQuery("#cdn_export_library_progress .bar").width(t+"%"),jQuery("#cdn_export_library_progress .percent").html(t+"%")},set_status:function(t){jQuery("#cdn_export_library_status").html(t)},set_processed:function(t){jQuery("#cdn_export_library_processed").html(t)},set_total:function(t){jQuery("#cdn_export_library_total").html(t)},set_button_text:function(t){jQuery("#cdn_export_library_start").val(t)},set_last_response:function(){var t=new Date;jQuery("#cdn_export_library_last_response").html(t.toLocaleTimeString()+" "+t.toLocaleDateString())},set_elapsed:function(t){jQuery("#cdn_export_library_elapsed").html(t)},add_log:function(t,e,s){jQuery("#cdn_export_library_log").prepend('<div class="log-'+(1==e?"success":"error")+'">'+t+" <strong>"+s+"</strong></div>")},clear_log:function(){jQuery("#cdn_export_library_log").html("")},process:function(){if(!this.paused){var e=this;jQuery.ajax({type:"POST",url:"admin.php?page=w3tc_cdn",data:{w3tc_cdn_export_library_process:1,limit:this.limit,offset:this.offset,_wpnonce:this.nonce},dataType:"json",success:function(t){e.set_last_response(),e.process_callback(t)},error:function(){e.set_last_response(),e.retry(e.retry_seconds)}})}},retry:function(t){if(!this.paused)if(this.set_status("request failed (retry in "+t+"s)"),t){var e=this;setTimeout(function(){e.retry(--t)},1e3)}else this.set_status("processing"),this.process()},process_callback:function(t,e){this.offset+=t.count,this.set_total(t.total),this.set_processed(this.offset),this.set_progress((100*this.offset/t.total).toFixed(0));for(var s=!1,r=0;r<t.results.length;r++)if(this.add_log(t.results[r].remote_path,t.results[r].result,t.results[r].error),-1==t.results[r].result){s=!0;break}s?(this.set_progress(0),this.set_processed(1),this.set_status("failed"),this.set_button_text("Start"),clearInterval(this.timer)):this.offset<t.total?this.process():(this.set_status("done"),this.set_button_text("Start"),clearInterval(this.timer))},timer_callback:function(){this.seconds_elapsed++,this.set_elapsed(w3tc_seconds_to_string(this.seconds_elapsed))},init:function(){var t=this;jQuery("#cdn_export_library_start").click(function(){"Pause"==this.value?(t.paused=1,t.set_status("paused"),t.set_button_text("Resume"),clearInterval(t.timer)):("Start"==this.value&&(t.offset=0,t.seconds_elapsed=0,t.clear_log(),t.set_progress(0),t.set_elapsed("-")),t.paused=0,t.set_status("processing"),t.set_button_text("Pause"),t.timer=setInterval(function(){t.timer_callback()},1e3)),t.process()})}},W3tc_Popup_Cdn_Import_Library={paused:0,limit:5,offset:0,retry_seconds:10,seconds_elapsed:0,timer:null,nonce:"",cdn_host:"",set_progress:function(t){jQuery("#cdn_import_library_progress .bar").width(t+"%"),jQuery("#cdn_import_library_progress .percent").html(t+"%")},set_status:function(t){jQuery("#cdn_import_library_status").html(t)},set_processed:function(t){jQuery("#cdn_import_library_processed").html(t)},set_total:function(t){jQuery("#cdn_import_library_total").html(t)},set_button_text:function(t){jQuery("#cdn_import_library_start").val(t)},set_last_response:function(){var t=new Date;jQuery("#cdn_import_library_last_response").html(t.toLocaleTimeString()+" "+t.toLocaleDateString())},set_elapsed:function(t){jQuery("#cdn_import_library_elapsed").html(t)},is_redirect_permanent:function(){return 0<jQuery("#cdn_import_library_redirect_permanent:checked").size()},is_redirect_cdn:function(){return 0<jQuery("#cdn_import_library_redirect_cdn:checked").size()},add_log:function(t,e,s){jQuery("#cdn_import_library_log").prepend('<div class="log-'+(1==e?"success":"error")+'">'+t+" <strong>"+s+"</strong></div>")},clear_log:function(){jQuery("#cdn_import_library_log").html("")},add_rule:function(t,e){if(!/^https?:\/\//.test(t)){e=this.is_redirect_cdn()?"http://"+(0<this.cdn_host.length?this.cdn_host:document.location.host)+"/"+e:"/"+e,0!=t.indexOf("/")&&(t="/"+t);var s=jQuery("#cdn_import_library_rules");s.val(s.val()+"Redirect "+(this.is_redirect_permanent()?"302 ":"")+t+" "+e+"\r\n")}},clear_rules:function(){jQuery("#cdn_import_library_rules").val("")},process:function(){if(!this.paused){var e=this,t=jQuery("input#cdn_import_external").is(":checked");jQuery.ajax({type:"POST",url:"admin.php?page=w3tc_cdn",data:{w3tc_cdn_import_library_process:1,limit:this.limit,offset:this.offset,_wpnonce:this.nonce,cdn_import_external:t},dataType:"json",success:function(t){e.set_last_response(),e.process_callback(t)},error:function(){e.set_last_response(),e.retry(e.retry_seconds)}})}},retry:function(t){if(!this.paused)if(this.set_status("request failed (retry in "+t+"s)"),t){var e=this;setTimeout(function(){e.retry(--t)},1e3)}else this.set_status("processing"),this.process()},process_callback:function(t){this.offset+=t.count,this.set_total(t.total),this.set_processed(this.offset),this.set_progress((100*this.offset/t.total).toFixed(0));for(var e=!1,s=0;s<t.results.length;s++)if(this.add_log(t.results[s].src,t.results[s].result,t.results[s].error),1==t.results[s].result)this.add_rule(t.results[s].src,t.results[s].dst);else if(-1==t.results[s].result){e=!0;break}e?(this.set_progress(0),this.set_processed(1),this.set_status("failed"),this.set_button_text("Start"),clearInterval(this.timer)):this.offset<t.total?this.process():(this.set_status("done"),this.set_button_text("Start"),clearInterval(this.timer))},timer_callback:function(){this.seconds_elapsed++,this.set_elapsed(w3tc_seconds_to_string(this.seconds_elapsed))},init:function(){var t=this;jQuery("#cdn_import_library_start").click(function(){"Pause"==this.value?(t.paused=1,t.set_button_text("Resume"),t.set_status("paused"),clearInterval(t.timer)):("Start"==this.value&&(t.offset=0,t.seconds_elapsed=0,t.clear_log(),t.set_progress(0),t.clear_rules(),t.set_elapsed("-")),t.paused=0,t.set_button_text("Pause"),t.set_status("processing"),t.timer=setInterval(function(){t.timer_callback()},1e3)),t.process()})}},W3tc_Popup_Cdn_Rename_Domain={paused:0,limit:25,offset:0,retry_seconds:10,seconds_elapsed:0,timer:null,nonce:"",set_progress:function(t){jQuery("#cdn_rename_domain_progress .bar").width(t+"%"),jQuery("#cdn_rename_domain_progress .percent").html(t+"%")},set_status:function(t){jQuery("cdn_rename_domain_status").html(t)},set_processed:function(t){jQuery("#cdn_rename_domain_processed").html(t)},set_total:function(t){jQuery("#cdn_rename_domain_total").html(t)},set_button_text:function(t){jQuery("#cdn_rename_domain_start").val(t)},set_last_response:function(){var t=new Date;jQuery("#cdn_rename_domain_last_response").html(t.toLocaleTimeString()+" "+t.toLocaleDateString())},set_elapsed:function(t){jQuery("#cdn_rename_domain_elapsed").html(t)},add_log:function(t,e,s){jQuery("#cdn_rename_domain_log").prepend('<div class="log-'+(1==e?"success":"error")+'">'+t+" <strong>"+s+"</strong></div>")},clear_log:function(){jQuery("#cdn_rename_domain_log").html("")},get_domain_names:function(){return jQuery("#cdn_rename_domain_names").val()},process:function(){if(!this.paused){var e=this;jQuery.ajax({type:"POST",url:"admin.php?page=w3tc_cdn",data:{w3tc_cdn_rename_domain_process:1,names:this.get_domain_names(),limit:this.limit,offset:this.offset,_wpnonce:this.nonce},dataType:"json",success:function(t){e.set_last_response(),e.process_callback(t)},error:function(){e.set_last_response(),e.retry(e.retry_seconds)}})}},retry:function(t){if(!this.paused)if(this.set_status("request failed (retry in "+t+"s)"),t){var e=this;setTimeout(function(){e.retry(--t)},1e3)}else this.set_status("processing"),this.process()},process_callback:function(t){this.offset+=t.count,this.set_total(t.total),this.set_processed(this.offset),this.set_progress((100*this.offset/t.total).toFixed(0));for(var e=!1,s=0;s<t.results.length;s++)if(this.add_log(t.results[s].old,t.results[s].result,t.results[s].error),-1==t.results[s].result){e=!0;break}e?(this.set_progress(0),this.set_processed(1),this.set_status("failed"),this.set_button_text("Start"),clearInterval(this.timer)):this.offset<t.total?this.process():(this.set_status("done"),this.set_button_text("Start"),clearInterval(this.timer))},timer_callback:function(){this.seconds_elapsed++,this.set_elapsed(w3tc_seconds_to_string(this.seconds_elapsed))},init:function(t){var e=this;this.cdn_host=t,jQuery("#cdn_rename_domain_start").click(function(){if("Pause"==this.value)e.paused=1,e.set_button_text("Resume"),e.set_status("paused"),clearInterval(e.timer);else{if("Start"==this.value){if(!e.get_domain_names())return void alert("Empty domains to rename!");e.offset=0,e.seconds_elapsed=0,e.clear_log(),e.set_progress(0),e.set_elapsed("-")}e.paused=0,e.set_button_text("Pause"),e.set_status("processing"),e.timer=setInterval(function(){e.timer_callback()},1e3)}e.process()})}};function w3tc_ps_expand(s){jQuery(".ps-rule").each(function(){var t=jQuery(this).find(".ps-expander"),e=jQuery(this).find(".ps-expand a");s?(t.show(),e.html("-")):(t.hide(),e.html("+"))})}jQuery(function(){jQuery(".tab").click(function(){jQuery(".tab").removeClass("tab-selected"),jQuery(".tab-content").hide(),jQuery(this).addClass("tab-selected"),jQuery(this.rel).show()}),jQuery(".cdn_queue_delete").click(function(){return confirm("Are you sure you want to remove this file from the queue?")}),jQuery(".cdn_queue_empty").click(function(){return confirm("Are you sure you want to empty the queue?")}),jQuery(".ps-rule").click(function(){var t=jQuery(this).find(".ps-expander"),e=jQuery(this).find(".ps-expand a");return t.is(":visible")?(t.hide(),e.html("+")):(t.show(),e.html("-")),!1}),jQuery(".ps-rule p a,.ps-expander").click(function(t){t.stopPropagation()}),jQuery(".ps-expand-all").click(function(){w3tc_ps_expand(1)}),jQuery(".ps-collapse-all").click(function(){w3tc_ps_expand(0)}),jQuery(".ps-refresh").click(function(){var t=jQuery(".w3tc-widget-ps-nonce").val();document.location.href="admin.php?page=w3tc_dashboard&w3tc_test_pagespeed_results&force=1&_wpnonce="+t})});