jQuery(function(a){a(".mega-blocks .mega-left").sortable({forcePlaceholderSize:!1,items:".block",stop:function(){o()},connectWith:".mega-blocks .mega-right, .mega-blocks .mega-center"}),a(".mega-blocks .mega-right").sortable({forcePlaceholderSize:!1,items:".block",stop:function(){o()},connectWith:".mega-blocks .mega-left, .mega-blocks .mega-center"}),a(".mega-blocks .mega-center").sortable({forcePlaceholderSize:!1,items:".block",stop:function(){o()},connectWith:".mega-blocks .mega-left, .mega-blocks .mega-right"});var o=function(){var t=0;a(".mega-blocks .block").each(function(){t++;var e=a(this);e.find("input, select, textarea").each(function(){void 0!==a(this).attr("name")&&a(this).attr("name",a(this).attr("name").replace(/\[\d+\]/g,"["+t+"]"))}),e.find("input.align").each(function(){e.parent().hasClass("mega-right")?a(this).attr("value","right"):e.parent().hasClass("mega-center")?a(this).attr("value","center"):a(this).attr("value","left")})})};a(".mega-toggle_blocks").on("click","a.mega-delete",function(e){e.preventDefault(),a(this).parent(".block-settings").parent(".block").remove(),o()}),a(".mega-toggle_blocks").on("click",".block-title",function(e){e.preventDefault(),e.stopPropagation();var t=a(this).parent().find(".block-settings");a(".block").removeClass("mega-open"),t.is(":visible")?(t.parent().removeClass("mega-open"),t.hide()):(t.parent().addClass("mega-open"),a(".block-settings").hide(),t.show())}),a("#toggle-block-selector").on("change",function(){var e=a("#toggle-block-selector").find(":selected").attr("value");"title"!=e&&a.ajax({type:"POST",url:ajaxurl,data:{action:"mm_get_toggle_block_"+e,_wpnonce:megamenu.nonce},cache:!1,success:function(e){var t=a(e);a(".mm_colorpicker",t).spectrum({preferredFormat:"rgb",showInput:!0,showAlpha:!0,clickoutFiresChange:!0,change:function(e){0===e.getAlpha()?a(this).siblings("div.chosen-color").html("transparent"):a(this).siblings("div.chosen-color").html(e.toRgbString())}}),a(".icon_dropdown",t).select2({containerCssClass:"tpx-select2-container select2-container-sm",dropdownCssClass:"tpx-select2-drop",minimumResultsForSearch:-1,formatResult:function(e){return'<i class="dashicons '+a(e.element).attr("data-class")+'"></i>'},formatSelection:function(e){return'<i class="dashicons '+a(e.element).attr("data-class")+'"></i>'}}),a(".mega-blocks .mega-left").append(t),o(),a("#toggle-block-selector").val("title"),a("body").trigger("toggle_block_content_loaded")}})})});