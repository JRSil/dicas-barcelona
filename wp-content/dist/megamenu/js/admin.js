!function(g){"use strict";g.fn.megaMenu=function(e){var d=g("<div />");d.settings=e,d.log=function(e){window.console&&console.log&&console.log(e.data),!0!==e.success&&alert(e.data)},d.init=function(){d.log({success:!0,data:megamenu.debug_launched+" "+d.settings.menu_item_id}),g.colorbox.remove(),g.colorbox({html:"",initialWidth:"75%",scrolling:!0,fixed:!0,top:"50px",initialHeight:"552",maxHeight:"570"}),g.ajax({type:"POST",url:ajaxurl,data:{action:"mm_get_lightbox_html",_wpnonce:megamenu.nonce,menu_item_id:d.settings.menu_item_id,menu_item_depth:d.settings.menu_item_depth,menu_id:d.settings.menu_id},cache:!1,beforeSend:function(){g("#cboxLoadedContent").empty(),g("#cboxClose").empty()},complete:function(){g("#cboxLoadingOverlay").remove(),void 0!==wp.textWidgets&&(wp.textWidgets.widgetControls={}),void 0!==wp.mediaWidgets&&(wp.mediaWidgets.widgetControls={}),void 0!==wp.customHtmlWidgets&&(wp.customHtmlWidgets.widgetControls={})},success:function(e){g("#cboxLoadingGraphic").remove();var t=g.parseJSON(e.data),n=g("<div />").addClass("mm_header_container"),a=g("<div />").addClass("mm_title").html(d.settings.menu_item_title),i=g("<div class='mm_saving'>"+megamenu.saving+"</div>");n.append(a).append(i);var o=g("<div class='mm_tab_container' />"),s=g("<div class='mm_content_container' />");null===t&&s.html(e),g.each(t,function(e){var t=g("<div />").addClass("mm_content").addClass(e).html(this.content).hide();if(t.find("form").on("submit",function(e){r(),e.preventDefault();var t=g(this).serialize();g.post(ajaxurl,t,function(e){c(),d.log(e)})}),"menu_icon"===e){var n=t.find("form.icon_selector").not(".icon_selector_custom");n.on("change",function(e){r(),e.preventDefault(),g("input",n).not(e.target).removeAttr("checked");var t=g(this).serialize();g.post(ajaxurl,t,function(e){c(),d.log(e)})})}if("general_settings"===e&&g("select#mega-item-align").on("change",function(){var e=jQuery(this),t=jQuery(this).val();e.next().children().hide(),e.next().children("."+t).show()}),"mega_menu"===e){var a=t.find("#mm_enable_mega_menu");a.on("change",function(){r();var e={action:"mm_save_menu_item_settings",settings:{type:a.val()},menu_item_id:d.settings.menu_item_id,_wpnonce:megamenu.nonce};g.post(ajaxurl,e,function(e){c(),"megamenu"==a.val()?(g("#widgets").removeClass("disabled").show(),g("#megamenu-grid").hide(),g("#mm_number_of_columns").show()):"grid"==a.val()?(g("#widgets").hide(),g("#megamenu-grid").show(),g("#mm_number_of_columns").hide()):(g("#widgets").show().removeClass("enabled").addClass("disabled"),g("#megamenu-grid").hide(),g("#mm_number_of_columns").show()),d.log(e)})}),l(t),m(t)}var i=g("<div />").addClass("mm_tab").addClass(e).html(this.title).css("cursor","pointer").on("click",function(){g(".mm_content").hide(),g(".mm_tab").removeClass("active"),g(this).addClass("active"),t.show()});(0==d.settings.menu_item_depth&&"mega_menu"==e||0<d.settings.menu_item_depth&&"general_settings"==e)&&(t.show(),i.addClass("active")),o.append(i),g(".mm_tab_horizontal",t).on("click",function(){var e=g(this),t=g(this).attr("rel");g(".filter_icons").val(""),g(".icon_selector > div").show(),e.addClass("active"),e.siblings().removeClass("active"),e.parent().siblings().not("h4").not("input").hide(),e.parent().siblings("."+t).show()}),g(".filter_icons",t).on("keyup",function(){var e=g(".filter_icons").val(),t=g(".icon_selector:visible div input"),n=t.filter(function(){return-1<g(this).attr("id").indexOf(e)});n.parent().show(),t.not(n).parent().hide()}),s.append(t)}),g("#cboxLoadedContent").addClass("depth-"+d.settings.menu_item_depth).append(n).append(o).append(s),g("#cboxLoadedContent").css({width:"100%",height:"100%",display:"block"}),g("#cboxLoadedContent").trigger("megamenu_content_loaded")}})};var m=function(a){var m=a.find("#megamenu-grid");a.find("#mm_widget_selector").on("change",function(){var e=a.find("#mm_enable_mega_menu");if(!e.length||"grid"==e.val()){var n=g(this);if("disabled"!=n.val()){var t={action:"mm_add_widget",id_base:n.val(),menu_item_id:d.settings.menu_item_id,is_grid_widget:"true",title:n.find("option:selected").text(),_wpnonce:megamenu.nonce};g.post(ajaxurl,t,function(e){var t=g(e.data);g(".mega-col-widgets:first").append(t),m.trigger("make_columns_sortable"),m.trigger("make_widgets_sortable"),m.trigger("update_column_block_count"),m.trigger("save_grid_data"),n.val("disabled")})}}}),m.on("click",".mega-add-column",function(){var n=g(this),e=n.parent().parent(),t=parseInt(e.attr("data-used-cols")),a=parseInt(e.attr("data-available-cols"));if(e.find(".mega-row-is-full").hide(),a<t+1)e.find(".mega-row-is-full").slideDown().delay(2e3).slideUp();else{var i=a-t,o={action:"mm_get_empty_grid_column",_wpnonce:megamenu.nonce};g.post(ajaxurl,o,function(e){var t=g(e.data);i<3&&(t.attr("data-span",i),t.find(".mega-num-cols").html(i)),n.parent().parent().append(t),m.trigger("make_columns_sortable"),m.trigger("make_widgets_sortable"),m.trigger("save_grid_data"),m.trigger("update_row_column_count"),m.trigger("update_column_block_count")})}}),m.on("click",".mega-col-description > .dashicons-trash",function(){g(this).closest(".mega-col").remove(),m.trigger("save_grid_data"),m.trigger("update_row_column_count")}),m.on("click",".mega-add-row",function(){var n=g(this),e={action:"mm_get_empty_grid_row",_wpnonce:megamenu.nonce};g.post(ajaxurl,e,function(e){var t=g(e.data);n.before(t),m.trigger("make_columns_sortable"),m.trigger("make_widgets_sortable"),m.trigger("save_grid_data"),m.trigger("update_row_column_count"),m.trigger("update_column_block_count")})}),m.on("click",".mega-row-actions > .dashicons-trash",function(){g(this).closest(".mega-row").remove(),m.trigger("save_grid_data")}),m.on("click",".mega-col-expand",function(){var e=g(this).closest(".mega-col"),t=parseInt(e.attr("data-span"),10);t<12&&(t+=1,e.attr("data-span",t),g(".mega-num-cols",e).html(t),m.trigger("save_grid_data"),m.trigger("update_row_column_count"))}),m.on("click",".mega-col-contract",function(){var e=g(this).closest(".mega-col"),t=parseInt(e.attr("data-span"),10);1<t&&(t-=1,e.attr("data-span",t),g(".mega-num-cols",e).html(t),m.trigger("save_grid_data"),m.trigger("update_row_column_count"))}),m.on("click",".widget-action",function(){var a=g(this).closest(".widget"),i=a.find("h4"),o=a.attr("data-id"),s=a.find(".widget-inner");a.hasClass("open")||a.data("loaded")?a.toggleClass("open"):(i.addClass("loading"),g.post(ajaxurl,{action:"mm_edit_widget",widget_id:o,_wpnonce:megamenu.nonce},function(e){var t=g(e),n=t;g(".delete",n).on("click",function(e){e.preventDefault(),a.remove();var t={action:"mm_delete_widget",widget_id:o,_wpnonce:megamenu.nonce};g.post(ajaxurl,t,function(e){d.log(e),m.trigger("save_grid_data"),m.trigger("update_column_block_count")})}),g(".close",n).on("click",function(e){e.preventDefault(),a.toggleClass("open")}),n.on("submit",function(e){e.preventDefault();var t=g(this).serialize();r(),g.post(ajaxurl,t,function(e){c(),d.log(e)})}),s.html(t),a.data("loaded",!0).toggleClass("open"),m.trigger("check_widget_inner_position",[s]),i.removeClass("loading"),a.is("[id*=black-studio-tinymce]")&&bstw(a).deactivate().activate(),setTimeout(function(){g(document).trigger("widget-added",[a])},100)})),m.trigger("check_widget_inner_position",[s]),g(".widget").not(a).removeClass("open")}),m.on("click",".mega-col-header .dashicons-admin-generic",function(){g(this).toggleClass("mega-settings-open"),g(this).closest(".mega-col").find(".mega-col-settings").slideToggle()}),m.on("click",".mega-row-header .dashicons-admin-generic",function(){g(this).toggleClass("mega-settings-open"),g(this).closest(".mega-row").find(".mega-row-settings").slideToggle()}),m.on("keyup",".widget-content input[name*='[title]'], .media-widget-control [id*='_title'].title, .custom-html-widget-fields [id*='_title'].title",function(){var e=g(this).val();if(0==e.length){var t=g(this).closest(".widget").find(".widget-title .widget-desc").html();g(this).closest(".widget").find(".widget-title h4").html(t)}else g(this).closest(".widget").find(".widget-title h4").html(e)}),m.on("click",".dashicons-desktop",function(){g(this);var e=g(this).parent().parent().parent().parent().find("input[name='mega-hide-on-desktop']"),t=g(this).parent();"true"==e.val()?(e.val("false"),t.removeClass("mega-disabled").addClass("mega-enabled")):(e.val("true"),t.removeClass("mega-enabled").addClass("mega-disabled")),m.trigger("save_grid_data")}),m.on("click",".dashicons-smartphone",function(){g(this);var e=g(this).parent().parent().parent().parent().find("input[name='mega-hide-on-mobile']"),t=g(this).parent();"true"==e.val()?(e.val("false"),t.removeClass("mega-disabled").addClass("mega-enabled")):(e.val("true"),t.removeClass("mega-enabled").addClass("mega-disabled")),m.trigger("save_grid_data")}),m.on("click",".mega-save-column-settings, .mega-save-row-settings",function(){m.trigger("save_grid_data")}),m.on("click",".mega-save-row-settings",function(){m.trigger("update_total_columns_in_row")}),m.on("check_widget_inner_position",function(e,t){var n=t.offset().left+t.width();g(".mm_content_container").offset().left+g(".mm_content_container").width()<n?t.css("right","0"):t.css("right","")}),m.on("save_grid_data",function(){r();var s=[];g(".mega-row",m).each(function(){var e=g(this).index(),t=g(this).find("input[name='mega-hide-on-desktop']").val(),n=g(this).find("input[name='mega-hide-on-mobile']").val(),a=g(this).find("input.mega-row-class").val(),i=g(this).find("select.mega-row-columns").val();s[e]={meta:{class:a,"hide-on-desktop":t,"hide-on-mobile":n,columns:i},columns:[]}}),g(".mega-col",m).each(function(){var e=g(this).parent().children(".mega-col").index(g(this)),t=g(this).parent(".mega-row").index(),n=g(this).attr("data-span"),a=g(this).find("input[name='mega-hide-on-desktop']").val(),i=g(this).find("input[name='mega-hide-on-mobile']").val(),o=g(this).find("input.mega-column-class").val();s[t].columns[e]={meta:{span:n,class:o,"hide-on-desktop":a,"hide-on-mobile":i},items:[]}}),g(".widget",m).each(function(){g(this).index();var e=g(this).attr("data-id"),t=g(this).attr("data-type"),n=g(this).closest(".mega-row").index(),a=g(this).closest(".mega-col"),i=a.parent().children(".mega-col").index(a),o={id:e,type:t};s[n].columns[i].items.push(o)}),g.post(ajaxurl,{action:"mm_save_grid_data",grid:s,parent_menu_item:d.settings.menu_item_id,_wpnonce:megamenu.nonce},function(e){c()}),m.trigger("update_row_column_count")}),m.on("update_total_columns_in_row",function(){g(".mega-row",m).each(function(){var e=g(this),t=g(this).find("select.mega-row-columns").val();g(this).attr("data-available-cols",t),g(".mega-col",e).not(".ui-sortable-helper").each(function(){g(this);g(this).find(".mega-num-total-cols").html(t)})})}),m.on("update_row_column_count",function(){m.trigger("update_total_columns_in_row"),g(".mega-row",m).each(function(){var e=g(this),t=0,n=e.attr("data-available-cols");g(".mega-col",e).not(".ui-sortable-helper").each(function(){var e=g(this);t+=parseInt(e.attr("data-span"),10)}),e.attr("data-used-cols",t),e.removeAttr("data-too-many-cols"),e.removeAttr("data-row-is-full"),n<t&&e.attr("data-too-many-cols","true"),t==n&&e.attr("data-row-is-full","true")})}),m.on("update_column_block_count",function(){g(".mega-col",m).each(function(){var e=g(this);e.attr("data-total-blocks",g(".mega-col-widgets > .widget",e).length)})}),m.on("make_rows_sortable",function(){m.sortable({forcePlaceholderSize:!0,items:".mega-row",placeholder:"drop-area",handle:".mega-row-header > .mega-row-actions > .dashicons-sort",tolerance:"pointer",start:function(e,t){g(".widget").removeClass("open"),t.item.data("start_pos",t.item.index())},stop:function(e,t){t.item.removeAttr("style"),t.item.data("start_pos")!==t.item.index()&&m.trigger("save_grid_data")}})}),m.on("make_widgets_sortable",function(){m.find(".mega-col-widgets").sortable({connectWith:".mega-col-widgets",forcePlaceholderSize:!0,items:".widget",placeholder:"drop-area",handle:".widget-top",helper:"clone",tolerance:"pointer",start:function(e,t){g(".widget").removeClass("open"),t.item.css("margin-top",g(window).scrollTop())},stop:function(e,t){t.item.removeAttr("style"),m.trigger("save_grid_data"),m.trigger("update_column_block_count")}})}),m.on("make_columns_sortable",function(){m.find(".mega-row").sortable({connectWith:".mega-row",forcePlaceholderSize:!1,items:".mega-col",placeholder:"drop-area",tolerance:"pointer",handle:".mega-col-header > .mega-col-description > .dashicons-move",start:function(e,t){t.placeholder.height(t.helper[0].scrollHeight),t.placeholder.width(t.item.width()-1),g(".widget").removeClass("open")},sort:function(e,t){m.trigger("update_row_column_count")},stop:function(e,t){m.trigger("save_grid_data"),t.item.removeAttr("style"),m.trigger("update_row_column_count")}})}),m.trigger("update_row_column_count"),m.trigger("update_column_block_count"),m.trigger("make_rows_sortable"),m.trigger("make_columns_sortable"),m.trigger("make_widgets_sortable")},l=function(i){var o=i.find("#widgets");i.find("#mm_number_of_columns").on("change",function(){o.attr("data-columns",g(this).val()),o.find(".widget-total-cols").html(g(this).val()),r();var e={action:"mm_save_menu_item_settings",settings:{panel_columns:g(this).val()},menu_item_id:d.settings.menu_item_id,_wpnonce:megamenu.nonce};g.post(ajaxurl,e,function(e){c(),d.log(e)})}),o.bind("reorder_widgets",function(){r();var e=[];g(".widget").each(function(){e.push({type:g(this).attr("data-type"),order:g(this).index()+1,id:g(this).attr("data-id"),parent_menu_item:d.settings.menu_item_id})}),g.post(ajaxurl,{action:"mm_reorder_items",items:e,_wpnonce:megamenu.nonce},function(e){c(),d.log(e)})}),o.sortable({forcePlaceholderSize:!0,items:".widget:not(.sub_menu)",placeholder:"drop-area",handle:".widget-top",start:function(e,t){g(".widget").removeClass("open"),t.item.data("start_pos",t.item.index())},stop:function(e,t){t.item.removeAttr("style"),t.item.data("start_pos")!==t.item.index()&&o.trigger("reorder_widgets")}}),i.find("#mm_widget_selector").on("change",function(){var e=i.find("#mm_enable_mega_menu");if(!e.length||"megamenu"==e.val()){var a=g(this);if("disabled"!=a.val()){r();var t={action:"mm_add_widget",id_base:a.val(),menu_item_id:d.settings.menu_item_id,title:a.find("option:selected").text(),_wpnonce:megamenu.nonce};g.post(ajaxurl,t,function(e){g(".no_widgets").hide();var t=g(e.data),n=i.find("#mm_number_of_columns").val();t.find(".widget-total-cols").html(n),g("#widgets").append(t),o.trigger("reorder_widgets"),c(),a.val("disabled")})}}}),o.on("click",".widget .widget-expand",function(){var e=g(this).closest(".widget"),t=e.attr("data-type"),n=e.attr("id"),a=parseInt(e.attr("data-columns"),10);a<parseInt(g("#mm_number_of_columns").val(),10)&&(a+=1,e.attr("data-columns",a),g(".widget-num-cols",e).html(a),r(),"widget"==t&&g.post(ajaxurl,{action:"mm_update_widget_columns",id:n,columns:a,_wpnonce:megamenu.nonce},function(e){c(),d.log(e)}),"menu_item"==t&&g.post(ajaxurl,{action:"mm_update_menu_item_columns",id:n,columns:a,_wpnonce:megamenu.nonce},function(e){c(),d.log(e)}))}),o.on("click",".widget .widget-contract",function(){var e=g(this).closest(".widget"),t=e.attr("data-type"),n=e.attr("id"),a=parseInt(e.attr("data-columns"),10),i=parseInt(g("#mm_number_of_columns").val(),10);i<a&&(a=i),1<a&&(a-=1,e.attr("data-columns",a),g(".widget-num-cols",e).html(a),r(),"widget"==t&&g.post(ajaxurl,{action:"mm_update_widget_columns",id:n,columns:a,_wpnonce:megamenu.nonce},function(e){c(),d.log(e)}),"menu_item"==t&&g.post(ajaxurl,{action:"mm_update_menu_item_columns",id:n,columns:a,_wpnonce:megamenu.nonce},function(e){c(),d.log(e)}))}),o.on("click",".widget .widget-action",function(){var a=g(this).closest(".widget"),i=a.find(".widget-title"),o=a.find(".widget-inner"),s=a.attr("id");a.hasClass("open")||a.data("loaded")?a.toggleClass("open"):(i.addClass("loading"),g.post(ajaxurl,{action:"mm_edit_widget",widget_id:s,_wpnonce:megamenu.nonce},function(e){var t=g(e),n=t;g(".delete",n).on("click",function(e){e.preventDefault();var t={action:"mm_delete_widget",widget_id:s,_wpnonce:megamenu.nonce};g.post(ajaxurl,t,function(e){a.remove(),d.log(e)})}),g(".close",n).on("click",function(e){e.preventDefault(),a.toggleClass("open")}),n.on("submit",function(e){e.preventDefault();var t=g(this).serialize();r(),g.post(ajaxurl,t,function(e){c(),d.log(e)})}),o.html(t),a.data("loaded",!0).toggleClass("open"),i.removeClass("loading"),a.is("[id*=black-studio-tinymce]")&&bstw(a).deactivate().activate(),setTimeout(function(){g(document).trigger("widget-added",[a])},100)})),g(".widget").not(a).removeClass("open")})},r=function(){g(".mm_saving").show()},c=function(){g(".mm_saving").fadeOut("fast")};d.init()}}(jQuery),jQuery(function(m){"use strict";m(".menu").on("click",".megamenu_launch",function(e){e.preventDefault(),m(this).megaMenu()}),m("#megamenu_accordion").accordion({heightStyle:"content",collapsible:!0,active:!1,animate:200});var e=function(){m("input.megamenu_enabled:checked")&&m("input.megamenu_enabled:checked").length?m("body").addClass("megamenu_enabled"):m("body").removeClass("megamenu_enabled")};m("input.megamenu_enabled").on("change",function(){e()}),e(),m("#menu-to-edit li.menu-item").each(function(){var n=m(this),a=m("input#menu").val(),i=n.find(".menu-item-title").text();n.data("megamenu_has_button","true"),i||(i=n.find(".item-title").text());var o=parseInt(n.attr("id").match(/[0-9]+/)[0],10),e=m("<span>").addClass("mm_launch").html(megamenu.launch_lightbox).on("click",function(e){if(e.preventDefault(),m("body").hasClass("megamenu_enabled")){var t=n.attr("class").match(/\menu-item-depth-(\d+)\b/)[1];m(this).megaMenu({menu_item_id:o,menu_item_title:i,menu_item_depth:t,menu_id:a})}else alert(megamenu.is_disabled_error)});if(m(".item-title",n).append(e),"true"===megamenu.css_prefix){var t=n.find(".edit-menu-item-classes"),s=m("<span>").addClass("mm_prefix").html(megamenu.css_prefix_message);t.after(s)}}),m(".megamenu_enabled #menu-to-edit").on("mouseenter mouseleave","li.menu-item",function(){var e=m(this);if(!e.data("megamenu_has_button")){e.data("megamenu_has_button","true");var t=m("<span>").addClass("mm_launch mm_disabled").html(megamenu.launch_lightbox).on("click",function(e){e.preventDefault(),alert(megamenu.save_menu)});m(".item-title",e).append(t)}}),m(".max-mega-menu-save").on("click",function(e){e.preventDefault(),m(".mega_menu_meta_box .spinner").css("visibility","visible");var t=JSON.stringify(m("[name^='megamenu_meta']").serializeArray());m.post(ajaxurl,{action:"mm_save_settings",menu:m("#menu").val(),megamenu_meta:t,nonce:megamenu.nonce},function(e){m(".mega_menu_meta_box .spinner").css("visibility","hidden")})})});